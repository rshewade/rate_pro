{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Setup Development Environment and Infrastructure",
        "description": "Configure local development environment including Vite dev server on port 3000, json-server mock API on port 3001, and Docker setup for containerization. Establish ESLint and Prettier for code quality and formatting.",
        "details": "Install and configure Vite with React 19 and Shadcn UI. Setup json-server with initial db.json reflecting MVP data schema. Configure Vite proxy to forward /api requests to json-server to avoid CORS issues. Create Dockerfiles and docker-compose for frontend and mock backend. Integrate ESLint and Prettier with project standards.",
        "testStrategy": "Verify that frontend runs on port 3000 and can successfully fetch data from json-server on port 3001 via proxy. Run linting and formatting checks. Test Docker containers start and communicate correctly.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "complexity": 5,
        "recommendedSubtasks": 4,
        "expansionPrompt": "Break down environment setup into subtasks for Vite and React setup, json-server configuration, Docker containerization, and ESLint/Prettier integration.",
        "updatedAt": "2025-11-29T09:38:17.434Z"
      },
      {
        "id": 2,
        "title": "Design and Implement Database Schema in Supabase",
        "description": "Create PostgreSQL schema in Supabase to support services, pricing factors, factor options, quotes, customers, business entity types, add-ons, and audit trails as per PRD data model.",
        "details": "Define tables for Services, Pricing Factors, Factor Options (with price_impact and price_impact_type), Business Entity Types, Add-ons, Quotes, Customers, Quote Versions, and Audit Logs. Implement relationships and constraints to enforce data integrity. Prepare migration scripts for deployment.",
        "testStrategy": "Validate schema correctness by inserting sample data for each table. Ensure foreign key constraints and data types are enforced. Test queries for retrieving service details with pricing factors and options.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Design and Implement Services Table Schema",
            "description": "Create the Services table schema in Supabase PostgreSQL including columns, data types, and constraints as per PRD.",
            "dependencies": [],
            "details": "Define the Services table with appropriate columns such as service_id (primary key), name, description, and any relevant attributes. Implement constraints like NOT NULL and unique indexes as needed. Prepare migration scripts for this table.",
            "status": "done",
            "testStrategy": "Insert sample service records and verify constraints and data integrity.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:23:03.852Z"
          },
          {
            "id": 2,
            "title": "Design and Implement Pricing Factors and Factor Options Schema",
            "description": "Create tables for Pricing Factors and Factor Options including price impact and price impact type, with relationships and constraints.",
            "dependencies": [],
            "details": "Define Pricing Factors table with columns like factor_id, name, description. Define Factor Options table with option_id, factor_id (foreign key), price_impact, price_impact_type (fixed, percentage, multiplier), and other relevant fields. Implement foreign key constraints and indexes. Prepare migration scripts.",
            "status": "done",
            "testStrategy": "Insert sample pricing factors and options, verify foreign key constraints and correct data types.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:23:03.859Z"
          },
          {
            "id": 3,
            "title": "Design and Implement Business Entity Types and Add-ons Schema",
            "description": "Create tables for Business Entity Types and Add-ons with necessary columns, relationships, and constraints.",
            "dependencies": [],
            "details": "Define Business Entity Types table with entity_type_id, name, description. Define Add-ons table with add_on_id, name, price, and association to services if applicable. Implement constraints and indexes. Prepare migration scripts for deployment.",
            "status": "done",
            "testStrategy": "Test insertion of sample business entity types and add-ons, verify constraints and relationships.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:23:03.865Z"
          },
          {
            "id": 4,
            "title": "Design and Implement Quotes, Customers, and Quote Versions Schema",
            "description": "Create tables for Quotes, Customers, and Quote Versions including relationships, constraints, and necessary fields.",
            "dependencies": [],
            "details": "Define Customers table with customer_id, contact details, business entity type reference. Define Quotes table with quote_id, customer_id (foreign key), status, expiration date, and pricing details. Define Quote Versions table to track changes over time. Implement foreign keys, constraints, and indexes. Prepare migration scripts.",
            "status": "done",
            "testStrategy": "Insert sample customers and quotes, verify foreign key constraints and data integrity.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:23:03.871Z"
          },
          {
            "id": 5,
            "title": "Design and Implement Audit Logs Schema with Relationships and Constraints",
            "description": "Create Audit Logs table to track changes across entities with appropriate columns, relationships, and constraints.",
            "dependencies": [],
            "details": "Define Audit Logs table with audit_id, entity_type, entity_id, action_type, timestamp, user_id, and change details. Implement constraints and indexes for efficient querying. Prepare migration scripts for deployment.",
            "status": "done",
            "testStrategy": "Insert sample audit log entries, verify data integrity and query performance.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:23:03.875Z"
          }
        ],
        "complexity": 7,
        "recommendedSubtasks": 5,
        "expansionPrompt": "Divide schema design into subtasks for each major entity: Services, Pricing Factors and Options, Business Entity Types, Quotes and Customers, and Audit Logs with relationships and constraints.",
        "updatedAt": "2025-12-10T05:23:03.875Z"
      },
      {
        "id": 3,
        "title": "Develop Pricing Calculation Engine Logic",
        "description": "Implement the core pricing calculation engine following the hybrid pricing model: base price, fixed impacts, percentage impacts, multiplier impacts, and fixed-price add-ons.",
        "details": "Implement calculation steps: start with base_price, add all fixed impacts, add percentage impacts based on base_price, apply multiplier impacts to running total, then add fixed-price add-ons. Ensure factor dependencies and price_impact_type are handled correctly. Prepare calculation logic for both client-side MVP and future Supabase Edge Functions.",
        "testStrategy": "Create unit tests covering various combinations of pricing factors and add-ons. Validate calculation accuracy against manual computations. Test prevention of circular dependencies in factor dependencies.",
        "priority": "high",
        "dependencies": [
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Base Price Calculation",
            "description": "Develop the logic to retrieve and set the base price as the starting point for the pricing calculation engine.",
            "dependencies": [],
            "details": "Create a function or module that fetches the base price from the relevant data source and initializes the calculation total with this value. Ensure this step is the foundation for subsequent impact calculations.",
            "status": "done",
            "testStrategy": "Unit test with various base price inputs to verify correct initialization.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:26:59.948Z"
          },
          {
            "id": 2,
            "title": "Implement Fixed Impacts Calculation",
            "description": "Add all fixed impact values to the base price as part of the pricing calculation sequence.",
            "dependencies": [
              1
            ],
            "details": "Develop logic to sum all fixed impact factors and add them to the running total after the base price is set. Handle factor dependencies and ensure no circular references occur.",
            "status": "done",
            "testStrategy": "Unit tests covering multiple fixed impacts and dependency scenarios, including circular dependency prevention.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:26:59.951Z"
          },
          {
            "id": 3,
            "title": "Implement Percentage Impacts Calculation",
            "description": "Calculate and add percentage-based impacts relative to the base price to the running total.",
            "dependencies": [
              1,
              2
            ],
            "details": "Implement logic to compute each percentage impact as a fraction of the base price and add the sum to the current total. Ensure correct handling of factor dependencies and impact types.",
            "status": "done",
            "testStrategy": "Unit tests verifying percentage calculations against known base prices and impact values.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:26:59.956Z"
          },
          {
            "id": 4,
            "title": "Implement Multiplier Impacts Application",
            "description": "Apply multiplier impacts to the running total after fixed and percentage impacts have been added.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "Create logic to multiply the current total by each multiplier impact factor sequentially. Confirm that dependencies and impact types are respected and that the calculation order is maintained.",
            "status": "done",
            "testStrategy": "Unit tests validating multiplier effects on various totals and combinations of multipliers.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:26:59.961Z"
          },
          {
            "id": 5,
            "title": "Integrate Fixed-Price Add-Ons and Handle Factor Dependencies",
            "description": "Add fixed-price add-ons to the final total and ensure all factor dependencies and price impact types are correctly managed for both client-side MVP and future Supabase Edge Functions.",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "Develop integration for fixed-price add-ons to be added after multipliers. Implement comprehensive dependency checks to prevent circular references and ensure compatibility with client-side and server-side execution environments.",
            "status": "done",
            "testStrategy": "Integration tests covering full calculation flow with add-ons, dependency validation, and environment compatibility checks.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:26:59.965Z"
          }
        ],
        "complexity": 8,
        "recommendedSubtasks": 5,
        "expansionPrompt": "Expand into subtasks for implementing base price calculation, fixed impacts, percentage impacts, multiplier impacts, and add-ons integration with dependency handling.",
        "updatedAt": "2025-12-10T05:26:59.965Z"
      },
      {
        "id": 4,
        "title": "Implement Calculator Interface with Dynamic Form Rendering",
        "description": "Build the React-based calculator UI allowing users to select services, dynamically render pricing factor forms, handle factor dependencies, and display real-time price calculations with itemized breakdown.",
        "details": "Create service selection dropdown/card grid (FR-1). Load pricing factors dynamically per selected service (FR-2). Implement logic to show/hide dependent factors and reset values when dependencies change (FR-3). Calculate and update price in real-time as user selects options (FR-4). Display detailed price breakdown (FR-7). Use Shadcn UI components for consistent styling.",
        "testStrategy": "Perform UI tests to verify dynamic form rendering and dependency handling. Validate real-time price updates with different factor selections. Confirm required fields validation before quote generation (FR-6).",
        "priority": "high",
        "dependencies": [
          "1",
          "3"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Service Selection UI",
            "description": "Create the user interface component for selecting services using dropdowns or card grids with Shadcn UI components.",
            "dependencies": [],
            "details": "Develop a React component that displays available services in a dropdown or card grid format, styled consistently with Shadcn UI. Ensure it supports user selection and triggers updates for pricing factors loading.",
            "status": "done",
            "testStrategy": "Verify UI renders correctly with all services. Test user can select and change services, triggering appropriate events.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.452Z"
          },
          {
            "id": 2,
            "title": "Load Pricing Factors Dynamically Based on Selected Service",
            "description": "Implement logic to fetch and render pricing factor forms dynamically when a service is selected.",
            "dependencies": [
              1
            ],
            "details": "Upon service selection, fetch the corresponding pricing factors data and render the associated form inputs dynamically. Ensure the form updates correctly when the selected service changes.",
            "status": "done",
            "testStrategy": "Test that selecting different services loads correct pricing factors. Confirm form updates and clears previous factors appropriately.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.459Z"
          },
          {
            "id": 3,
            "title": "Implement Dependency-Based Form Rendering and Reset Logic",
            "description": "Develop logic to show or hide pricing factors based on dependencies and reset factor values when dependencies change.",
            "dependencies": [
              2
            ],
            "details": "Create a system to evaluate factor dependencies, conditionally rendering form fields. When a dependency changes, reset dependent factor values to maintain data integrity.",
            "status": "done",
            "testStrategy": "Validate that dependent factors appear/disappear correctly based on selections. Confirm values reset when dependencies change.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.464Z"
          },
          {
            "id": 4,
            "title": "Implement Real-Time Price Calculation",
            "description": "Calculate and update the total price in real-time as users select or modify pricing factors.",
            "dependencies": [
              3
            ],
            "details": "Integrate pricing calculation logic that listens to form changes and updates the displayed price immediately, reflecting all selected factors and their impacts.",
            "status": "done",
            "testStrategy": "Test price updates instantly with each factor change. Verify calculation accuracy against expected results.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.470Z"
          },
          {
            "id": 5,
            "title": "Display Detailed Price Breakdown",
            "description": "Show an itemized breakdown of the price components based on selected services and pricing factors.",
            "dependencies": [
              4
            ],
            "details": "Design and implement a UI component that lists each pricing factor's contribution to the total price, updating dynamically as selections change.",
            "status": "done",
            "testStrategy": "Ensure breakdown updates correctly with factor changes. Confirm all price components are accurately represented.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.475Z"
          },
          {
            "id": 6,
            "title": "Implement Validation Logic for Pricing Factors",
            "description": "Add validation to ensure required pricing factors are selected and inputs are valid before price calculation and quote generation.",
            "dependencies": [
              3
            ],
            "details": "Develop validation rules for pricing factor inputs, enforcing required fields and valid data formats. Integrate validation feedback into the UI to guide users.",
            "status": "done",
            "testStrategy": "Test validation triggers on invalid or missing inputs. Confirm users cannot proceed without completing required fields.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.479Z"
          }
        ],
        "complexity": 8,
        "recommendedSubtasks": 6,
        "expansionPrompt": "Create subtasks for service selection UI, dynamic loading of pricing factors, dependency-based form rendering, real-time price calculation, price breakdown display, and validation logic.",
        "updatedAt": "2025-12-10T05:27:42.479Z"
      },
      {
        "id": 5,
        "title": "Add Add-on Selection Feature to Calculator",
        "description": "Enable users to select from global and service-specific add-ons with fixed prices, integrating these selections into the pricing calculation.",
        "details": "Fetch and display available add-ons (FR-5). Allow multi-selection with clear UI. Integrate add-on fixed prices into the pricing engine calculation. Ensure add-ons availability can be configured per service line in admin panel.",
        "testStrategy": "Test add-on selection UI and verify add-on prices are correctly added to total price. Confirm add-ons respect service-specific availability.",
        "priority": "medium",
        "dependencies": [
          "4",
          "3"
        ],
        "status": "done",
        "subtasks": [],
        "complexity": 6,
        "recommendedSubtasks": 3,
        "expansionPrompt": "Split into subtasks for fetching and displaying add-ons, multi-selection UI implementation, and integration of add-on prices into the calculation engine.",
        "updatedAt": "2025-11-29T11:09:54.186Z"
      },
      {
        "id": 6,
        "title": "Implement Quote Generation and Customer Information Capture",
        "description": "Develop functionality to capture customer details, generate unique quote numbers, set configurable expiration dates, and save quotes with initial status as Draft.",
        "details": "Create forms to capture customer info (Company, Contact, Email, etc.) (FR-8). Implement unique quote number generation and default expiration date logic (FR-9). Save quote data including selected services, factors, add-ons, and pricing breakdown to backend. Set initial quote status to Draft.",
        "testStrategy": "Validate form input and required fields. Confirm unique quote numbers are generated. Verify expiration date defaults and status assignment. Test quote persistence in backend.",
        "priority": "high",
        "dependencies": [
          "4",
          "5",
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create Customer Information Capture Form",
            "description": "Design and implement a user-friendly form to capture essential customer details such as Company, Contact Name, Email, and other relevant fields.",
            "dependencies": [],
            "details": "Develop a single-column form with logically grouped fields, starting with easiest inputs like name and email, clearly marking required fields, and providing inline validation and error messages. Use native input types for better UX, e.g., email and date pickers. Ensure accessibility and mobile responsiveness.",
            "status": "done",
            "testStrategy": "Validate form field presence, required field enforcement, inline validation, and usability on desktop and mobile devices.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:03:48.113Z"
          },
          {
            "id": 2,
            "title": "Implement Unique Quote Number Generation",
            "description": "Develop backend logic to generate unique quote numbers for each new quote to ensure traceability and avoid duplication.",
            "dependencies": [],
            "details": "Create a system that generates sequential or otherwise unique identifiers for quotes, ensuring thread-safe and collision-free generation. Integrate this logic with quote creation workflows so each saved quote receives a unique number.",
            "status": "done",
            "testStrategy": "Test uniqueness of generated quote numbers under concurrent quote creation scenarios and verify correct assignment to saved quotes.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:03:48.117Z"
          },
          {
            "id": 3,
            "title": "Develop Configurable Expiration Date Logic",
            "description": "Implement logic to set default expiration dates for quotes based on configurable parameters, allowing flexibility in quote validity periods.",
            "dependencies": [],
            "details": "Create a mechanism to calculate expiration dates automatically when a quote is generated, using configurable settings (e.g., number of days from creation). Allow for overrides if needed. Integrate this with quote data before saving.",
            "status": "done",
            "testStrategy": "Verify default expiration dates are correctly calculated and applied according to configuration, including edge cases and overrides.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:03:48.120Z"
          },
          {
            "id": 4,
            "title": "Save Quote Data with Initial Draft Status",
            "description": "Implement functionality to persist complete quote data—including customer info, selected services, pricing factors, add-ons, and pricing breakdown—to the backend with the initial status set to Draft.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "Develop backend APIs and database schema to store all relevant quote information. Ensure the initial status field is set to 'Draft' upon creation. Integrate with front-end form submission and quote number and expiration logic.",
            "status": "done",
            "testStrategy": "Test saving of complete quote data, verify initial status is 'Draft', confirm data integrity and retrieval from backend.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:03:48.124Z"
          }
        ],
        "complexity": 7,
        "recommendedSubtasks": 4,
        "expansionPrompt": "Divide into subtasks for customer info form creation, unique quote number generation, expiration date logic, and saving quote data with initial status.",
        "updatedAt": "2025-11-29T12:03:48.124Z"
      },
      {
        "id": 7,
        "title": "Develop Quote Management Interfaces",
        "description": "Build list and detail views for quotes with filtering, sorting, search, status tracking, versioning, and editing capabilities.",
        "details": "Implement Quote List View with filters and search (FR-12). Create Quote Detail View showing line items, status history, and notes (FR-13). Enable status updates and automatic expiration handling (FR-14). Allow editing of draft quotes and version creation for sent quotes (FR-15).",
        "testStrategy": "Test UI for listing, filtering, and searching quotes. Verify status transitions and expiration logic. Confirm editing and versioning workflows function correctly.",
        "priority": "high",
        "dependencies": [
          "6",
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Quote List View with Filtering and Search",
            "description": "Develop the user interface to display a list of quotes with capabilities for filtering by various criteria and searching by keywords.",
            "dependencies": [],
            "details": "Create a responsive Quote List View component that supports filtering options such as date range, status, and customer, as well as a search bar to find quotes by text input. Ensure integration with backend APIs to fetch filtered and searched data dynamically.",
            "status": "done",
            "testStrategy": "Test UI responsiveness, verify filtering and search return correct results, and validate integration with backend data sources.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:25:44.623Z"
          },
          {
            "id": 2,
            "title": "Create Quote Detail View with Line Items, Status History, and Notes",
            "description": "Build the detailed view for individual quotes showing all line items, the history of status changes, and any associated notes.",
            "dependencies": [
              1
            ],
            "details": "Design and implement the Quote Detail View component that displays comprehensive information about a selected quote, including line items breakdown, chronological status updates, and user notes. Ensure data consistency and smooth navigation from the list view.",
            "status": "done",
            "testStrategy": "Verify correct display of all quote details, test navigation from list to detail view, and validate data accuracy for line items, status history, and notes.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:25:44.627Z"
          },
          {
            "id": 3,
            "title": "Enable Status Updates and Automatic Expiration Handling",
            "description": "Implement functionality to update quote statuses manually and automatically expire quotes based on predefined rules.",
            "dependencies": [
              2
            ],
            "details": "Develop backend and frontend logic to allow users to change quote statuses (e.g., Draft, Sent, Approved) and implement automatic expiration of quotes after their expiration date passes. Include notifications or UI indicators for expired quotes.",
            "status": "done",
            "testStrategy": "Test manual status updates for correctness, verify automatic expiration triggers at the right time, and confirm UI reflects current status accurately.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:25:44.633Z"
          },
          {
            "id": 4,
            "title": "Allow Editing of Draft Quotes",
            "description": "Provide editing capabilities for quotes that are in Draft status, enabling users to modify quote details before sending.",
            "dependencies": [
              3
            ],
            "details": "Implement editing interfaces and validation for draft quotes, allowing changes to line items, customer info, and pricing factors. Ensure that edits are saved correctly and do not affect sent or finalized quotes.",
            "status": "done",
            "testStrategy": "Test editing workflows on draft quotes, validate data persistence, and ensure editing is disabled for non-draft statuses.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:25:44.638Z"
          },
          {
            "id": 5,
            "title": "Implement Version Creation for Sent Quotes",
            "description": "Enable creation of new versions of quotes once they have been sent, preserving previous versions and allowing updates.",
            "dependencies": [
              4
            ],
            "details": "Develop versioning logic to create a new quote version when edits are needed on sent quotes. Maintain history of versions with timestamps and status. Provide UI to view and manage different versions of a quote.",
            "status": "done",
            "testStrategy": "Verify version creation triggers correctly, test version history display, and ensure previous versions remain immutable.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T12:25:44.641Z"
          }
        ],
        "complexity": 7,
        "recommendedSubtasks": 5,
        "expansionPrompt": "Break down into subtasks for quote list view with filtering/search, quote detail view, status updates and expiration handling, editing draft quotes, and versioning sent quotes.",
        "updatedAt": "2025-11-29T12:25:44.641Z"
      },
      {
        "id": 8,
        "title": "Implement PDF Export and Quote Preview Features",
        "description": "Provide professional quote preview with company branding and enable exporting quotes to PDF format.",
        "details": "Design quote preview UI (FR-10) reflecting branding and detailed pricing breakdown. Integrate PDF generation library to export quotes maintaining formatting and layout (FR-11). Ensure export works for multi-service quotes and includes all relevant data.",
        "testStrategy": "Verify preview displays accurate and complete quote information. Test PDF export for correctness, formatting, and completeness. Confirm multi-service quotes export properly.",
        "priority": "medium",
        "dependencies": [
          "7"
        ],
        "status": "done",
        "subtasks": [],
        "complexity": 6,
        "recommendedSubtasks": 3,
        "expansionPrompt": "Create subtasks for designing quote preview UI, integrating PDF generation library, and ensuring multi-service quote export correctness.",
        "updatedAt": "2025-11-29T12:51:54.409Z"
      },
      {
        "id": 9,
        "title": "Build Admin Panel for Service and Pricing Configuration",
        "description": "Create admin interfaces for full CRUD operations on services, pricing factors, factor options, business entity types, and add-ons with pricing modifiers.",
        "details": "Implement service catalog management (FR-16). Enable adding/configuring pricing factors per service (FR-17) and managing factor options including price impact (FR-18). Provide CRUD for business entity types and modifiers (FR-20). Manage global and service-specific add-ons (FR-21). Use React with Shadcn UI for consistent admin UX.",
        "testStrategy": "Test all CRUD operations for correctness and data validation. Verify pricing modifiers and factor options are saved and reflected in calculator. Confirm add-on availability configuration per service.",
        "priority": "high",
        "dependencies": [
          "1",
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement Service Catalog CRUD Interface",
            "description": "Develop full Create, Read, Update, Delete (CRUD) functionality for managing the service catalog as per FR-16.",
            "dependencies": [],
            "details": "Create React components using Shadcn UI to list services, add new services, edit existing services, and delete services. Integrate with backend API endpoints to persist changes. Ensure validation and error handling for service data.",
            "status": "done",
            "testStrategy": "Test all CRUD operations for services including form validation, successful data persistence, and UI updates.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T11:28:48.936Z"
          },
          {
            "id": 2,
            "title": "Develop Pricing Factors Management UI",
            "description": "Enable adding and configuring pricing factors for each service according to FR-17 requirements.",
            "dependencies": [
              1
            ],
            "details": "Build React components to display pricing factors linked to services, allow creation, editing, and deletion of pricing factors. Use Shadcn UI components for consistent styling. Connect to backend APIs to save pricing factor data.",
            "status": "done",
            "testStrategy": "Verify CRUD operations on pricing factors work correctly and pricing factors are correctly associated with services.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T11:28:48.941Z"
          },
          {
            "id": 3,
            "title": "Create Factor Options Configuration Interface",
            "description": "Implement management of factor options including their price impact as specified in FR-18.",
            "dependencies": [
              2
            ],
            "details": "Design UI components to add, edit, and delete factor options under each pricing factor. Include fields for price impact types and values. Ensure data validation and backend integration for persistence.",
            "status": "done",
            "testStrategy": "Test creation, update, and deletion of factor options and confirm price impact data is saved and reflected properly.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T11:28:48.948Z"
          },
          {
            "id": 4,
            "title": "Build Business Entity Types CRUD Functionality",
            "description": "Provide full CRUD operations for business entity types and their pricing modifiers as per FR-20.",
            "dependencies": [],
            "details": "Develop React components with Shadcn UI to list, create, update, and delete business entity types and associated pricing modifiers. Integrate with backend services to persist changes.",
            "status": "done",
            "testStrategy": "Validate all CRUD operations for business entity types and modifiers, including data integrity and UI consistency.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T11:28:48.951Z"
          },
          {
            "id": 5,
            "title": "Implement Add-Ons Management Interface",
            "description": "Manage global and service-specific add-ons with pricing modifiers according to FR-21.",
            "dependencies": [
              1
            ],
            "details": "Create UI components to list add-ons, assign them globally or to specific services, and configure pricing modifiers. Use Shadcn UI for consistent look and feel. Connect to backend APIs for data operations.",
            "status": "done",
            "testStrategy": "Test add-on creation, assignment, modification, and deletion. Confirm pricing modifiers are correctly applied and saved.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T11:28:48.956Z"
          },
          {
            "id": 6,
            "title": "Ensure UI Consistency Using Shadcn UI Components",
            "description": "Standardize the admin panel UI by integrating Shadcn UI components across all CRUD interfaces for a consistent user experience.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5
            ],
            "details": "Review all admin panel components and replace or style them using Shadcn UI components. Ensure uniform design patterns, responsive layouts, and accessibility compliance.",
            "status": "done",
            "testStrategy": "Perform UI/UX testing to verify consistent styling, responsiveness, and usability across all admin panel pages.",
            "parentId": "undefined",
            "updatedAt": "2025-11-29T11:28:48.961Z"
          }
        ],
        "complexity": 8,
        "recommendedSubtasks": 6,
        "expansionPrompt": "Expand into subtasks for service catalog CRUD, pricing factors management, factor options configuration, business entity types CRUD, add-ons management, and UI consistency with Shadcn components.",
        "updatedAt": "2025-11-29T11:28:48.961Z"
      },
      {
        "id": 10,
        "title": "Implement Factor Dependency Rules and Validation in Admin Panel",
        "description": "Enable defining, testing, and validating dependency rules between pricing factors to prevent circular dependencies and ensure correct conditional logic.",
        "details": "Provide UI to define dependency conditions between factors (FR-19). Implement logic to test dependency rules and detect circular dependencies. Integrate 'Test Calculator' mode to validate pricing logic and dependencies (FR-22).",
        "testStrategy": "Create test cases for various dependency scenarios. Confirm circular dependencies are detected and prevented. Validate 'Test Calculator' mode outputs expected pricing results.",
        "priority": "medium",
        "dependencies": [
          "9",
          "3"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Develop UI for Defining Dependency Rules Between Pricing Factors",
            "description": "Create an intuitive user interface in the admin panel that allows users to define and manage dependency conditions between pricing factors as specified in FR-19.",
            "dependencies": [],
            "details": "Design and implement UI components to select pricing factors and specify dependency conditions, ensuring usability and validation of input. Use consistent styling and integrate with backend APIs to save and retrieve dependency rules.",
            "status": "done",
            "testStrategy": "Perform UI tests to verify correct rendering and input validation. Test saving and loading of dependency rules through the UI.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.647Z"
          },
          {
            "id": 2,
            "title": "Implement Logic to Detect Circular Dependencies in Factor Rules",
            "description": "Develop backend logic to analyze defined dependency rules and detect any circular dependencies to prevent invalid configurations.",
            "dependencies": [
              1
            ],
            "details": "Implement algorithms to traverse dependency graphs of pricing factors and identify cycles. Integrate this logic with rule saving and testing workflows to block circular dependencies and provide meaningful error messages.",
            "status": "done",
            "testStrategy": "Create unit tests with various dependency scenarios including circular and non-circular cases. Verify detection accuracy and error handling.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.655Z"
          },
          {
            "id": 3,
            "title": "Integrate 'Test Calculator' Mode for Validating Pricing Logic and Dependencies",
            "description": "Incorporate the 'Test Calculator' mode (FR-22) into the admin panel to allow users to validate pricing calculations and dependency rules interactively.",
            "dependencies": [
              1,
              2
            ],
            "details": "Extend the admin panel to include a test mode where users can input test data and see pricing outputs based on current dependency rules. Ensure real-time feedback and error reporting for invalid dependencies.",
            "status": "done",
            "testStrategy": "Conduct integration tests to confirm that test calculator mode reflects correct pricing outputs and respects dependency rules. Validate user interactions and error messages.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.661Z"
          },
          {
            "id": 4,
            "title": "Implement Validation Workflows for Dependency Rules and Pricing Logic",
            "description": "Create workflows to validate dependency rules and pricing logic systematically, ensuring correctness before deployment.",
            "dependencies": [
              2,
              3
            ],
            "details": "Develop processes that run validation checks on dependency rules and pricing logic, including circular dependency detection and test calculator validations. Provide reports or alerts for issues found.",
            "status": "done",
            "testStrategy": "Test validation workflows with multiple scenarios to ensure all errors are caught and reported. Verify that workflows integrate smoothly with UI and backend logic.",
            "parentId": "undefined",
            "updatedAt": "2025-12-10T05:27:42.666Z"
          }
        ],
        "complexity": 7,
        "recommendedSubtasks": 4,
        "expansionPrompt": "Divide into subtasks for UI to define dependency rules, logic to detect circular dependencies, integration of test calculator mode, and validation workflows.",
        "updatedAt": "2025-12-10T05:27:42.666Z"
      },
      {
        "id": 11,
        "title": "Implement Audit Trail for Pricing and Quote Changes",
        "description": "Log all final quote price changes including who made the change, what was changed, and when, to support audit and compliance requirements.",
        "details": "Design audit log schema and integrate logging in quote save/update operations (FR-23). Capture user identity (future authentication), timestamp, and change details. Provide admin UI to view audit logs.",
        "testStrategy": "Verify audit entries are created on quote price changes. Test retrieval and display of audit logs. Confirm data integrity and completeness.",
        "priority": "low",
        "dependencies": [
          "6",
          "9"
        ],
        "status": "done",
        "subtasks": [],
        "complexity": 5,
        "recommendedSubtasks": 3,
        "expansionPrompt": "Split into subtasks for audit log schema design, integration of logging in quote operations, and admin UI for audit log viewing.",
        "updatedAt": "2025-11-29T13:12:36.306Z"
      },
      {
        "id": 12,
        "title": "Create In-App RatePro User Manual Documentation Page",
        "description": "Implement a comprehensive in-app user manual for all RatePro features, exposed as a dedicated Documentation route with sidebar navigation using existing Shadcn UI components, including illustrative visual examples of key pricing and configuration concepts, including pricing factor input types and their usage.",
        "status": "done",
        "dependencies": [
          "1",
          "2",
          "3",
          "4",
          "6",
          "7",
          "8",
          "9",
          "10",
          "11"
        ],
        "priority": "medium",
        "details": "1. Functional scope & content structure\n- Define a documentation information architecture aligned with the requested sections:\n  - Overview / Getting Started (optional but recommended for context)\n  - Calculator Usage\n  - Quote Management\n  - PDF Export\n  - Admin Panel (with subsections: Services, Pricing Factors & Options, Business Entity Types & Modifiers, Add-ons, Factor Dependency Rules, Test Calculator)\n  - Audit Trail\n- For each section, draft clear, action-oriented step-by-step instructions describing:\n  - Where to find the feature within the existing UI (navigation path, page names).\n  - What each key control does (buttons, inputs, filters, toggles) using consistent naming with the live UI.\n  - Typical workflows (e.g., creating a quote from the calculator, editing a draft, exporting to PDF, viewing audit logs).\n  - Any relevant constraints, statuses, or edge cases (e.g., Draft vs Sent quotes, quote expiration, when versions are created).\n- Follow established user manual best practices: short sentences, active voice, task-based headings, and scannable lists for procedures.\n- Integrate **illustrations and visual examples** throughout the content to reinforce complex pricing concepts, admin configurations, and **pricing factor input types**, ensuring each visual is clearly captioned and referenced from the surrounding text.\n\n2. Frontend architecture & routing\n- Add a new top-level route in the app for the documentation, e.g. `/docs` or `/documentation`, wired into the existing router configuration.\n- Ensure this route is accessible from the main navigation (e.g., header nav item, help icon, or footer link) and visually consistent with existing app layout (same shell, header, theming).\n- Decide whether documentation content will be static (hardcoded React components/MDX) or data-driven (fetched from a JSON/Markdown source); for initial implementation, prefer static components for simplicity and reliability.\n\n3. Page layout & navigation (Shadcn UI)\n- Implement a two-column layout for the documentation page:\n  - Left: persistent **sidebar navigation** with section links and indentation for subsections (particularly under Admin Panel).\n  - Right: scrollable main content area.\n- Use appropriate Shadcn UI primitives (e.g., `ScrollArea`, `Card`, `Tabs`, `Accordion`, `Button`, `Badge`, typography components) to maintain a clean, readable layout that matches the rest of the app.\n- Implement anchor-based navigation:\n  - Assign stable `id` attributes to each top-level section and important subsections.\n  - Make sidebar items scroll to the corresponding anchors (e.g., via hash links or programmatic scroll).\n  - Optionally highlight the active section in the sidebar based on scroll position for better orientation.\n- Ensure responsive design so that on smaller screens the sidebar can collapse into a dropdown or off-canvas panel while keeping navigation usable.\n\n4. Section-specific content guidelines\n- Calculator Usage\n  - Explain how to select a service from the calculator interface, including any service selection UI elements.\n  - Describe how dynamic pricing factors appear based on the selected service and how to configure them (dropdowns, sliders, checkboxes, etc.), including notes on required vs optional fields.\n  - Clarify how entity types are selected and how they affect pricing conceptually (without duplicating deep technical logic).\n  - Document how to add or remove add-ons and how they impact the price summary.\n  - Walk users through generating a quote from the calculator: validating inputs, triggering quote creation, and what they should expect to see afterward.\n  - Add **visual callouts** around the calculator UI (annotated screenshots or mock components) to show where pricing factors, entity type selectors, add-ons, and **different factor input types (Select, Number, Toggle)** appear.\n  - Include a **Calculator UI input type gallery** that visually contrasts how Select, Number, and Toggle factor types are rendered side by side for a single example service.\n\n- Quote Management\n  - Document the Quote List view: filters, search, sorting options, status chips, and key columns.\n  - Show how to open a quote detail view and interpret its sections (line items, status history, notes, versions).\n  - Provide step-by-step flows for:\n    - Filtering and searching quotes.\n    - Editing a Draft quote and saving changes.\n    - Updating quote status (e.g., Draft → Sent → Accepted/Rejected) and understanding automatic expiration behavior.\n    - Creating a new version when modifying a sent quote and how versions are displayed or selected.\n  - Where relevant, include simple mock screenshots or HTML/CSS mockups of the list and detail layouts with labels for key controls.\n\n- PDF Export\n  - Explain how to access the quote preview screen for a given quote.\n  - Describe the main elements of the preview (branding, customer details, itemized pricing, totals, terms if present).\n  - Provide instructions for exporting to PDF (which button to click, what happens during generation, expected download behavior, and any browser considerations like pop-up blockers).\n  - Include a small annotated preview mockup indicating where export actions and key quote sections are located.\n\n- Admin Panel\n  - Services\n    - Describe how to navigate to the Services management area.\n    - Explain adding a new service, editing an existing one, and deleting/deactivating services, including any required fields.\n  - Pricing Factors & Factor Options\n    - Show how to add/configure pricing factors per service and what each configuration option means at a high level.\n    - Give examples of factor options with different price impacts (fixed, percentage, multipliers) without exposing internal implementation details.\n    - Add **factor type illustrations** demonstrating:\n      - A fixed impact example (e.g., \"+$100 for expedited service\").\n      - A percentage impact example (e.g., \"+10% for complexity\").\n      - A multiplier impact example (e.g., \"×1.5 for high volume\").\n    - Use color-coded labels or badges to distinguish each `price_impact_type` in these examples.\n    - Add **Factor Type Input Illustrations** showing how different `factor_type` inputs are configured and used:\n      - **Select type**: Admin configuration form for a factor like \"Transaction Volume\" with multiple predefined options (e.g., \"0-50\", \"51-200\", \"201-500\", \"500+\") and associated price impacts, plus the corresponding dropdown in the calculator.\n      - **Number type**: Admin configuration for a numeric factor such as \"Number of Employees\", including min/max constraints and step configuration, plus the corresponding number input in the calculator.\n      - **Toggle type**: Admin configuration for a binary factor such as \"Multi-state Filing\" with on/off states and related price impact, plus the corresponding toggle or checkbox in the calculator.\n    - Include **guidance on when to use each factor type**:\n      - **Select**: Best for predefined tiers or categories with specific pricing impacts.\n      - **Number**: Best for variable quantities that affect pricing calculation.\n      - **Toggle**: Best for yes/no features or optional services.\n  - Business Entity Types & Price Modifiers\n    - Explain how to define entity types and modify pricing for each (e.g., surcharges/discounts), and how these map back to selections in the calculator.\n    - Provide **entity type comparison visuals**, such as a small table or cards showing side-by-side price calculations for Sole Prop, LLC, S-Corp, C-Corp, etc., with different modifiers applied.\n  - Add-ons (Global and Service-specific)\n    - Document how to create and manage global add-ons vs service-specific add-ons, including assigning them to services.\n    - Include **add-on configuration examples** that visually contrast global add-ons with service-specific ones (e.g., two panels or tables).\n    - Show how add-ons appear in the calculator UI with an annotated mockup, and how multiple selected add-ons contribute to the price breakdown.\n  - Factor Dependency Rules\n    - Explain what dependency rules do in business terms (e.g., \"show this factor only when X is selected\").\n    - Show how to create, edit, and delete dependency rules and what to watch for (e.g., avoiding circular conditions conceptually).\n    - Add **dependency flow diagrams** using SVG or styled components to illustrate:\n      - How one factor’s visibility depends on another factor’s option.\n      - How circular dependencies are prevented (e.g., highlighting an invalid loop vs a valid tree of dependencies).\n      - Before/after examples of conditional factor display in the calculator.\n  - Test Calculator\n    - Document how to launch Test Calculator mode from the admin panel.\n    - Explain how admins can simulate different configurations and verify that pricing and factor visibility behave as expected, including testing Select, Number, and Toggle factor types together.\n    - Include at least one illustrative scenario (with a simple table or screenshot-style mockup) showing test inputs, including various factor types, and resulting pricing.\n\n- Audit Trail\n  - Describe where to access audit logs in the admin UI.\n  - Explain how to read each column (who changed what, when, and the nature of the change).\n  - Give examples of typical audit entries related to quote price changes or configuration updates.\n  - Optionally provide a visual example of an audit log table with highlighted rows and annotations.\n\n- Calculation Walkthrough (can live under Calculator Usage or Admin Panel > Pricing Factors)\n  - Provide a **step-by-step visual breakdown** of the pricing pipeline:\n    - Base price → Fixed impacts → Percentage impacts → Multipliers → Entity modifier → Add-ons → Final price.\n  - Use example calculation tables with real numbers to illustrate each step and running totals.\n  - Include an annotated diagram or mocked price breakdown component that labels each part of the calculation and shows which configuration element it comes from.\n\n5. Content & illustration implementation details\n- Break content into reusable React components where helpful, for example:\n  - `<DocsLayout>` for the shared layout and sidebar.\n  - `<DocsSection>` for each main section, accepting `id`, `title`, and children.\n  - Optional `<StepList>` or styled ordered lists for procedural steps.\n  - Dedicated visual components such as `<FactorImpactExample>`, `<DependencyFlowDiagram>`, `<EntityComparisonTable>`, `<AddOnBreakdown>`, `<CalculationWalkthrough>`, and **`<FactorTypeInputGallery>`** to keep illustration logic reusable and consistent.\n- Implement illustrations using:\n  - Simple **SVG diagrams** or inline SVG React components for flowcharts and dependency visuals.\n  - Styled HTML/CSS (with Shadcn `Card`, `Table`, `Badge`, `Alert`, `Input`, `Select`, `Switch`, etc.) for example tables and mock UI elements, especially for factor type input examples.\n  - Icons from **lucide-react** where appropriate (e.g., info, warning, flow, calculator, toggle) for visual consistency with the app.\n  - Color-coded boxes or badges to distinguish different impact types (fixed, percentage, multiplier, entity modifier, add-on) while maintaining accessibility, and clearly labeled indicators for different `factor_type` inputs (Select, Number, Toggle).\n- Use consistent typography hierarchy (e.g., H1 for page/title, H2 for main sections, H3/H4 for subsections), and ensure headings map 1:1 with sidebar entries.\n- Add optional callouts (e.g., “Tips” or “Notes”) using bordered or lightly shaded boxes to highlight best practices or important caveats, including tips on choosing the correct factor type.\n- Consider minimal internal linking between sections (e.g., from Calculator Usage to Quote Management) to reflect real workflows.\n- Keep content language non-technical and role-appropriate: clearly distinguish between user-facing features and admin-only features.\n\n6. Accessibility & UX considerations\n- Ensure the documentation page is fully keyboard navigable: sidebar links focusable, visible focus states, and logical tab order.\n- Use semantic HTML for headings, lists, and navigation landmarks (`<nav>` for sidebar, `<main>` for content).\n- Provide sufficient color contrast for text and interactive elements, matching the design system.\n- Ensure that instructions and illustrations do not rely solely on color (e.g., combine color with labels, icons, or patterns).\n- Provide descriptive alternative text or labels for SVG diagrams and illustrative components where they convey essential information, including descriptions of Select, Number, and Toggle factor type examples.\n\n7. Extensibility & maintenance\n- Centralize section metadata (id, title, description, sidebar label) in a configuration object so future docs sections can be added without restructuring the whole page.\n- Similarly centralize illustration metadata (e.g., example labels, legend for impact type colors, and factor type labels) to keep visuals consistent across sections.\n- Include developer-facing comments or a short internal guide in the code explaining how to:\n  - Add a new doc section.\n  - Reorder sections.\n  - Update content safely.\n  - Add or update illustration components, including guidance on using SVG, tables, and lucide-react icons.\n- Optionally, design content components to later support localization (wrapping static strings for future i18n), including captions and alt text for illustrations.\n",
        "testStrategy": "1. Navigation and routing\n- Verify the Documentation page is accessible from the main app navigation and loads under the correct route path without console errors.\n- Confirm that direct navigation to the documentation URL works (including refresh and deep links to anchors, if used).\n\n2. Sidebar behavior\n- Ensure all sidebar items scroll to the correct section in the main content area and that URLs update appropriately if hash-based anchors are used.\n- On desktop, confirm the sidebar remains visible while scrolling the main content and that the currently viewed section is visually indicated if active-state logic is implemented.\n- On mobile/tablet breakpoints, verify the sidebar collapses into the intended pattern (e.g., drawer or dropdown) and remains fully usable.\n\n3. Content coverage & accuracy\n- For each requested area (Calculator Usage, Quote Management, PDF Export, Admin Panel subsections, Audit Trail, Calculation Walkthrough), confirm there is a clearly labeled section matching the specification.\n- Cross-check each documented workflow against the implemented UI from Tasks 4, 6, 7, 8, 9, 10, and 11 to ensure terminology, button labels, and flows are accurate and up to date.\n- Ask a team member unfamiliar with the implementation to follow the manual to:\n  - Generate a quote from the calculator.\n  - Manage and version quotes.\n  - Export a quote to PDF.\n  - Create/update services, factors, add-ons, and dependency rules in the admin panel and use Test Calculator.\n  - View and interpret audit logs.\n  Confirm they can complete each task without external guidance.\n\n4. Layout, readability, and UX\n- Check that headings, subheadings, and step lists are readable, visually distinct, and consistently styled using Shadcn components.\n- Verify that long sections scroll smoothly, text is not cut off, and no horizontal scrolling appears at common viewport widths.\n- Confirm that content uses concise, active voice instructions and avoids ambiguous phrasing.\n- Ensure visual examples do not clutter the page: verify appropriate spacing, alignment, and that each illustration is paired with a clear caption or heading.\n\n5. Illustration-specific testing\n- Confirm that all required illustration types are present and contextually correct:\n  - Factor type examples (fixed, percentage, multiplier) with accurate sample calculations.\n  - **Factor Type Input Illustrations** for Select, Number, and Toggle factor types in both Admin Panel configuration and Calculator UI.\n  - Guidance visuals showing when to use each factor type (Select vs Number vs Toggle) with clear labels.\n  - Dependency flow diagrams showing valid and invalid (circular) dependency scenarios.\n  - Entity type comparison visuals demonstrating different price modifiers.\n  - Add-on configuration visuals showing global vs service-specific add-ons and their effect on price breakdown.\n  - End-to-end calculation walkthrough with a numeric example that matches the actual calculation engine.\n- Validate that SVG diagrams render correctly in supported browsers and scale appropriately on different screen sizes.\n- Check color usage in illustrations for sufficient contrast and that each color has a corresponding text/icon legend so diagrams remain understandable in grayscale.\n\n6. Accessibility and quality\n- Use browser dev tools or an automated checker (e.g., Lighthouse/axe) to confirm basic accessibility checks pass for the documentation page (semantic structure, contrast, landmarks).\n- Tab through the page to ensure focus order is logical and focus indicators are visible for all interactive elements in the sidebar, content, and any interactive illustration components.\n- Verify that all informative SVGs and diagrams have meaningful alt text or aria labels, or are described in nearby text, including all factor type input illustrations.\n- Run ESLint and existing project formatting tools to ensure no linting or formatting issues are introduced.\n",
        "subtasks": [],
        "updatedAt": "2025-12-10T05:44:01.453Z"
      },
      {
        "id": 13,
        "title": "Enhance Number Factor Type for Quantity × Unit Price Pricing",
        "description": "Extend the Number factor type to support true quantity-based pricing by adding unit price and label fields, updating calculations, UI, Supabase schema, and tests.",
        "details": "Implementation plan:\n\n1. Data model & database migration\n- Add new columns to the Supabase `pricing_factors` (or equivalent) table:\n  - `unit_price` DECIMAL(12,2) or DECIMAL(18,4) NOT NULL DEFAULT 0 for monetary precision.\n  - `unit_label` VARCHAR(64) NULL for display-only unit context (e.g., \"hour\", \"employee\").\n- Ensure `unit_price` and `unit_label` are **only meaningful for factors where `type === 'number'`**; other factor types should ignore these fields.\n- Create a forward migration script adding the columns with appropriate defaults and constraints, and a backward migration dropping them.\n- If there is a central TypeScript/JS type definition for factors, extend it to include:\n  - `unit_price?: number | string` (depending on current money handling) and `unit_label?: string`.\n\n2. API layer (supabaseApi.js)\n- Update factor fetch/parse logic to include `unit_price` and `unit_label` in the factor object.\n- Update factor create/update methods to send `unit_price` and `unit_label` to Supabase when `type === 'number'`.\n- Apply input normalization at the API boundary:\n  - Coerce `unit_price` from string inputs in forms to numeric (or decimal-string) representation consistently.\n  - Trim `unit_label` and reject excessively long labels.\n- Maintain backward compatibility so existing factors without these fields continue to work with default values.\n\n3. Pricing calculation engine (src/lib/pricing/calculator.js)\n- Analyze current calculation flow from Task 3: base_price → fixed impacts → percentage impacts → multiplier impacts → fixed-price add-ons.\n- Introduce explicit logic for Number-type factors with quantity pricing:\n  - For each factor where `type === 'number'` and `unit_price` is not null/0 and the user has entered a numeric `value`:\n    - Compute `factor_total = value * unit_price`.\n    - Decide and document **which impact bucket** this belongs to (e.g., treat as a fixed impact line item that is added to the running total after other fixed impacts but before percentage impacts, or follow existing `price_impact_type` semantics if those must still apply).\n  - Ensure that negative or zero quantities are handled according to business rules:\n    - Prefer: clamp to a minimum of 0 or validate at UI/API layer to prevent invalid quantities.\n- Keep the existing behavior for Select factors and Number factors without `unit_price` (they should still behave as discrete options with fixed price impacts).\n- Ensure factor dependency logic from Task 3/10 still applies; quantity-based Number factors must respect dependency enable/disable states.\n- Refactor the calculator code where helpful for clarity:\n  - Isolate a helper such as `calculateNumberFactorQuantityPrice(factor, value)` with clear unit tests.\n\n4. Admin Panel UI (PricingFactorsTable.jsx)\n- Locate the factor configuration table/form for Admin Panel from Task 9.\n- For rows where `factor.type === 'number'`:\n  - Show inputs for:\n    - `Unit price` (currency-aware input, e.g., using a numeric input with 2–4 decimal places).\n    - `Unit label` (simple text input with placeholder like \"hour\", \"employee\", \"transaction\").\n- Hide or disable these fields for non-Number types.\n- Add inline help text/tooltips explaining that **Number factors with a unit price will calculate as quantity × unit price**.\n- Respect existing form validation and error display patterns:\n  - Validate `unit_price ≥ 0`.\n  - Optional `unit_label`, but recommended when `unit_price > 0`.\n- Ensure the Admin Panel persists these fields via the updated supabaseApi calls.\n\n5. Calculator UI updates\n- In the end-user calculator interface (where factors are displayed and configured):\n  - For Number factors with a non-zero `unit_price`:\n    - Display unit context near the input, e.g., label or helper text like `$25/hour` (or `{currency}{unit_price}/{unit_label}`).\n    - When a value is entered, show a small computed breakdown such as `$25/hour × 10 = $250` next to or under the field.\n  - If no `unit_price` is set, keep the current Number factor UI unchanged.\n- Ensure this breakdown is purely informational and always matches the calculator engine’s computed value.\n- Follow existing design system (Shadcn UI), typography, and spacing conventions.\n\n6. Documentation hooks (optional but recommended)\n- Coordinate with the in-app documentation (Task 12) to ensure the new behavior is documentable:\n  - Add or update copy snippets to explain quantity-based Number factors and how admins should configure them.\n- Ensure labels and help text in Admin and Calculator UI align with this documentation for consistency.\n\n7. Security, performance, and UX considerations\n- Use safe numeric handling:\n  - Avoid floating-point rounding issues by either using integer minor units (e.g., cents) or consistent rounding to 2–4 decimals at display time.\n- Validate all numeric inputs both client-side and server-side to prevent injection or malformed data.\n- Ensure that adding these computations does not significantly impact performance; the calculation is O(n) across factors and should remain lightweight.\n\n8. Migration and rollout\n- Ensure a non-breaking rollout path:\n  - Existing factors without `unit_price`/`unit_label` must behave exactly as before.\n  - New columns should have sensible defaults so legacy data loads without errors.\n- Provide a brief internal migration note describing how to backfill or set unit prices for existing services that will adopt this feature (e.g., CFO services, payroll, bookkeeping examples).\n",
        "testStrategy": "1. Unit tests for calculator logic\n- Create tests in the pricing calculation engine for Number factors with `unit_price`:\n  - `10 hours × $25/hour = $250` added correctly to the total.\n  - `100 employees × $5/employee = $500`.\n  - `1,000 transactions × $0.50/transaction = $500`.\n- Verify combinations with other pricing elements from Task 3:\n  - Base price + quantity-based Number factor + fixed impacts.\n  - Percentage impacts applied after adding quantity-based amounts (according to defined order of operations).\n  - Multiplier impacts applied to a total that includes quantity-based amounts.\n- Confirm that Number factors **without** `unit_price` retain the old behavior and still work with existing test cases.\n- Add tests for dependency scenarios where a quantity-based Number factor is disabled by a dependency rule so its quantity charge is not applied.\n\n2. API and data layer tests\n- Add or extend tests for supabaseApi.js to ensure:\n  - Fetching factors includes `unit_price` and `unit_label`.\n  - Creating/updating Number factors sends and persists these fields correctly.\n  - Non-Number factors ignore these fields and are not broken by the schema changes.\n\n3. Database migration tests\n- Run migration on a test database with existing factor data.\n- Verify:\n  - New columns appear with correct types and defaults.\n  - Existing factors can still be read and used by the app without setting `unit_price`/`unit_label`.\n- Test rollback of the migration in a non-production environment.\n\n4. Admin Panel UI tests\n- Manual and/or automated UI tests in PricingFactorsTable.jsx:\n  - For a Number factor, confirm that `unit_price` and `unit_label` inputs are visible, editable, and persisted.\n  - For non-Number factors, confirm that these inputs are hidden or disabled.\n  - Validate form behavior on invalid input (negative price, non-numeric input, overly long label) and ensure error messages follow existing patterns.\n\n5. Calculator UI tests\n- For a configured Number factor with `unit_price` and `unit_label`:\n  - Verify the UI shows `{currency}{unit_price}/{unit_label}` near the input.\n  - Enter sample values (e.g., 10, 0, 100) and confirm that the on-screen breakdown (e.g., `$25/hour × 10 = $250`) matches the total from the calculator engine.\n  - Confirm responsiveness and layout integrity across screen sizes.\n- For Number factors without `unit_price`, verify the UI remains unchanged and no breakdown is shown.\n\n6. Regression and integration tests\n- Run the full test suite from Task 3, 5, 9, 10, 11, and 12 to ensure:\n  - Overall quote totals are unchanged for configurations not using quantity-based Number factors.\n  - Add-ons, factor dependencies, and audit logging still function correctly with the new pricing behavior.\n  - In-app documentation still loads and, where applicable, references the updated Number factor behavior accurately.\n",
        "status": "pending",
        "dependencies": [
          3,
          9,
          10,
          12,
          "14"
        ],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 14,
        "title": "Fix PricingFactorForm to render different input types based on factor_type",
        "description": "Update the PricingFactorForm component to render appropriate input types (Select, Checkbox/Toggle, Number input) based on the factor's factor_type instead of always using Select.",
        "details": "1. In `src/components/calculator/PricingFactorForm.jsx`, modify the form rendering logic to conditionally render different input types based on `factor.factor_type`:\n   - If `factor.factor_type === 'select'`: render the existing Select dropdown with options.\n   - If `factor.factor_type === 'boolean'`: render a Checkbox or Toggle switch component (preferably a Shadcn UI Toggle or Switch if available) that toggles between true/false.\n   - If `factor.factor_type === 'number'`: render an `<Input type=\"number\" />` field that accepts numeric values.\n\n2. For boolean type:\n   - The Checkbox/Toggle should control whether the factor is \"applied\".\n   - When toggled ON, the factor's price impact should be included in the calculation.\n   - When toggled OFF, the factor should have no price impact.\n   - Store the value in `selectedFactors` as `true`/`false` or as the option_id if the boolean factor has a single option that represents the \"on\" state.\n\n3. For number type:\n   - The number input should allow the user to enter a numeric value.\n   - Store the entered value (as a number) in `selectedFactors` for that factor.\n   - Ensure the value is properly parsed and stored as a number, not a string.\n\n4. Update the pricing calculator engine in `src/lib/pricing/calculator.js` to handle:\n   - Boolean factors: apply the price impact only when the factor value is `true`.\n   - Number factors: store and pass through the numeric value (current behavior for now, to be enhanced in Task 13 for quantity × unit_price calculation).\n\n5. Update the `useCalculator` hook if necessary to handle the different value types (boolean and number) correctly when updating `selectedFactors` and calculating the price.\n\n6. Ensure backward compatibility:\n   - Existing select-type factors must continue to work exactly as before.\n   - The form should gracefully handle any unknown or missing `factor_type` by defaulting to the select behavior or throwing a clear error in development.\n\n7. Use Shadcn UI components where possible (e.g., `Switch`, `Toggle`, `Input`) for consistent styling and accessibility.\n\nExample code structure:\n```jsx\nfunction PricingFactorForm({ factor, value, onChange }) {\n  if (factor.factor_type === 'select') {\n    return <Select value={value} onValueChange={onChange} options={factor.options} />;\n  }\n  \n  if (factor.factor_type === 'boolean') {\n    return (\n      <div>\n        <label>{factor.label}</label>\n        <Switch checked={value} onCheckedChange={onChange} />\n      </div>\n    );\n  }\n  \n  if (factor.factor_type === 'number') {\n    return (\n      <div>\n        <label>{factor.label}</label>\n        <Input\n          type=\"number\"\n          value={value}\n          onChange={(e) => onChange(parseFloat(e.target.value) || 0)}\n        />\n      </div>\n    );\n  }\n  \n  // Fallback to select for unknown types\n  return <Select value={value} onValueChange={onChange} options={factor.options} />;\n}\n```",
        "testStrategy": "1. Verify that for a factor with `factor_type: 'select'`, the form renders a Select dropdown and behaves as before (correct options, updates selectedFactors correctly).\n2. Verify that for a factor with `factor_type: 'boolean'`, the form renders a Checkbox or Toggle switch:\n   - Toggling ON applies the factor's price impact in the total.\n   - Toggling OFF removes the factor's price impact.\n   - The value in `selectedFactors` is `true` when ON and `false` when OFF (or the appropriate option_id if using option-based boolean).\n3. Verify that for a factor with `factor_type: 'number'`, the form renders a number input:\n   - Entering a number updates `selectedFactors` with that numeric value.\n   - The value is stored as a number, not a string.\n   - The calculator engine correctly stores and passes the number value (no calculation changes yet; this is just data plumbing for Task 13).\n4. Confirm that changing between factor types in the admin panel (Task 9) correctly updates the input type in the calculator UI.\n5. Test edge cases:\n   - Factor with missing or invalid `factor_type` falls back to select behavior.\n   - Number input handles non-numeric input gracefully (e.g., empty, NaN, negative numbers if allowed).\n   - Boolean toggle works correctly when reset or when dependencies change (Task 4 behavior).\n6. Perform integration tests with the pricing engine to ensure boolean and number factors do not break existing calculations and that select factors still work correctly.",
        "status": "pending",
        "dependencies": [
          3,
          4,
          9
        ],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 15,
        "title": "Implement Quote Edit Functionality",
        "description": "Enable users to edit existing draft quotes by clicking an Edit button in the quote detail view, which navigates to the Calculator pre-filled with the quote's data and allows saving changes back to the existing quote.",
        "details": "1. In `QuoteDetail.jsx`, add an `onEdit` prop to the component and wire it up to the Edit button's `onClick` handler. When clicked, this should trigger the edit flow with the current quote data.\n\n2. Update `QuotesManager.jsx` to accept an `onEdit` prop and pass it down to `QuoteDetail` when rendering quote details. This handler will be provided by the parent component (App.jsx) and will handle the navigation and data transfer.\n\n3. In `App.jsx`, implement the edit navigation logic. When the edit handler is called, navigate to the Calculator route and pass the full quote object (including service, factors, add-ons, entity type, and customer info) as route state or via context/state management.\n\n4. Modify `Calculator.jsx` to accept an optional `editQuote` prop. When this prop is present, the component should:\n   - Display a visual indicator (e.g., banner or heading) showing that the user is editing an existing quote (e.g., \"Editing Quote QT-2024-0001\").\n   - Pre-fill all form fields with the quote data: selected service, pricing factors and their values, selected add-ons, entity type, and customer information.\n   - Provide a cancel button that discards changes and returns to the quote detail view without saving.\n\n5. Update the `useCalculator` hook to support initializing the form state from an existing quote object. This includes setting the selected service, restoring factor values, selected add-ons, entity type, and customer fields based on the `editQuote` data.\n\n6. When the user saves the quote in edit mode, ensure the existing quote is updated (not a new quote created). This means the save action should use an update/PUT operation on the quote resource, preserving the quote number and updating the draft with new values. The quote status should remain Draft unless explicitly changed.\n\n7. Ensure that after saving an edited quote, the user is redirected back to the updated quote detail view, and the quote list reflects any changes (e.g., updated totals or customer info).",
        "testStrategy": "1. Verify that the Edit button in `QuoteDetail` is visible for draft quotes and triggers the `onEdit` handler when clicked.\n2. Confirm that clicking Edit navigates to the Calculator view and that the URL/route state correctly passes the quote data.\n3. Test that the Calculator pre-fills all fields correctly when an `editQuote` is provided: service selection, factor values, add-ons, entity type, and customer information.\n4. Check that a clear visual indicator (e.g., \"Editing Quote QT-2024-0001\") is displayed in the Calculator during edit mode.\n5. Validate that changes made in the Calculator are reflected in the final quote when saved, and that the existing quote is updated (same quote number, updated fields) rather than a new quote being created.\n6. Test the cancel functionality: after making changes in edit mode, clicking cancel should discard changes and return to the quote detail without modifying the original quote.\n7. Verify that the quote list and detail view reflect the updated data after saving an edited quote, including any changes to pricing or customer info.",
        "status": "pending",
        "dependencies": [
          6,
          7
        ],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 16,
        "title": "UI Improvements: Currency Switch to GBP and Admin Pricing Factors Service Filter",
        "description": "Update the application UI and configuration to use GBP (£) instead of USD ($) everywhere, and add a service dropdown filter to the Admin Panel Pricing Factors tab to improve manageability of factors per service.",
        "details": "1. Currency change from USD to GBP\n- Identify a single **currency configuration source** (e.g., `src/lib/pricing/calculator.js` or a new `src/config/currency.ts`/`.js`) exposing at least:\n  - `CURRENCY_CODE = 'GBP'`\n  - `CURRENCY_SYMBOL = '£'`\n  - Optional: a `formatCurrency(amount: number) => string` helper using Intl.NumberFormat with `en-GB` and GBP.\n- Replace hard-coded `$`/`USD` with references to the shared currency config or helper across the app:\n  - `src/components/calculator/PriceBreakdown.jsx` – ensure all line items, totals, and subtotals render using the new currency formatting helper or `CURRENCY_SYMBOL`.\n  - `src/components/calculator/PricingFactorForm.jsx` – update any currency labels or option labels that currently embed `$` (e.g., help text like \"$ per unit\") to use `£` or a dynamic currency symbol, being careful not to break `factor_type` handling added by Task 14.\n  - `src/components/quote/QuotePreview.jsx` – ensure all monetary values use `£` and the same formatter.\n  - `src/components/quote/QuotePDF.jsx` – ensure the PDF view uses `£` consistently (e.g., totals, line items, taxes) and uses the shared formatting helper to avoid divergence from the on-screen preview.\n  - `src/components/admin` components that display prices (Pricing factors, options, add-ons) – standardize on the same currency helper.\n- Update **default currency in configuration/database**:\n  - Locate any config or database seed (e.g., json-server `db.json`, Supabase seed, or constants in `calculator.js`) that define `USD` as the default currency and update to `GBP`.\n  - If quotes or pricing factors store a currency code, update defaults for new records to `GBP` while leaving existing persisted data intact unless a migration is explicitly required.\n  - If the pricing calculation engine or audit trail embeds currency codes or symbols in logs or stored records, ensure they pull from the config instead of hard-coded `USD`.\n- Ensure **price formatting** is consistent:\n  - Implement or reuse a `formatCurrencyGBP` function that formats as `£1,234.56` and apply it globally for all monetary fields instead of manual string concatenation.\n  - Refactor any ad-hoc number-to-currency logic in `src/lib/pricing/calculator.js` so that calculation logic deals with pure numbers, and only UI layers are responsible for rendering with symbols.\n\n2. Admin Panel – Service dropdown filter on Pricing Factors tab\n- In `src/components/admin/PricingFactorsTable.jsx` (or equivalent admin pricing factors container):\n  - Fetch or accept a list of **services** (ID + name) from the Admin Panel’s existing service configuration (from Task 9) via props or internal data fetch.\n  - Add a controlled **Service dropdown/select** UI at the top of the Pricing Factors section:\n    - Options include `All Services` plus each service by display name.\n    - Internally track selected value as e.g. `selectedServiceId` (string | null), with `null` or `'all'` representing all services.\n  - Implement **filtering logic**:\n    - Pricing factors should be filtered based on their associated `service_id` (or equivalent relation field) when a specific service is selected.\n    - When `All Services` is selected, show all factors as per current behavior.\n    - Ensure the filter integrates with existing pagination, sorting, and search (if any) to avoid double-filtering or conflicting state.\n  - Implement **default selection behavior**:\n    - On initial load, default to `All Services` if present, otherwise default to the first service in the list.\n- Persisting filter selection within Admin Panel navigation:\n  - Store `selectedServiceId` in a location that survives navigation within the Admin Panel, such as:\n    - URL query param (e.g., `?serviceId=...`), or\n    - React context/provider scoped to Admin layout, or\n    - Local storage keyed to the current admin user and view.\n  - On component mount, read and apply the persisted selection so the user returns to their last-used filter when navigating back to Pricing Factors.\n- UX considerations:\n  - Ensure the dropdown is clearly labeled (e.g., \"Filter by Service\") and aligned with existing Admin Panel styles (Shadcn UI or other design system used in Task 9).\n  - Handle edge cases where there are no services or no factors for a selected service by showing a clear empty-state message.\n\n3. Implementation considerations & refactoring\n- Avoid mixing formatting with business logic:\n  - Confirm that Task 3’s calculation engine remains currency-agnostic (numeric only) and that this task only changes presentation and configuration.\n- Ensure compatibility with Task 13/14 behavior:\n  - Where PricingFactorForm displays unit pricing or labels for number factors with `unit_price` (from Task 13), ensure these are shown in `£` using the common formatter without breaking conditional input rendering from Task 14.\n- Performance & maintainability:\n  - Keep the service filter logic in `PricingFactorsTable` as a pure state + derived data pattern (no unnecessary re-fetches when only the filter changes, unless the backend API already supports server-side filtering by service).\n  - Consider extracting a small reusable `ServiceFilterSelect` component if other Admin tabs will need the same filter later.\n",
        "testStrategy": "1. Currency switch verification\n- Run the app and navigate through Calculator, Quote Preview, Quote PDF, and Admin Panel.\n- In **PriceBreakdown**, verify all line items, subtotals, taxes, and totals display with the `£` symbol and correct GBP formatting, with no remaining `$` symbols or \"USD\" labels.\n- In **PricingFactorForm**, confirm any labels or helper texts that reference currency now show `£` (or a generic label using the dynamic symbol), and that select/boolean/number input behavior from Task 14 remains unchanged.\n- In **QuotePreview** and **QuotePDF**, generate a quote and confirm that every displayed monetary amount uses `£` and that values match across preview and PDF for the same quote.\n- Check Admin Panel lists and detail forms (services, factors, options, add-ons) to ensure all prices are shown in `£` using consistent formatting.\n- Inspect any config/seed data for new records (e.g., creating a new quote or pricing factor) to confirm the default currency is `GBP` (when visible in UI or via API response).\n\n2. Admin Pricing Factors service filter behavior\n- Open the Admin Panel, go to the Pricing Factors tab.\n- Confirm a **Service dropdown** is visible above the factors table with options for `All Services` and each defined service.\n- With `All Services` selected, verify that the list shows all factors (baseline behavior).\n- Select a specific service and verify that only factors whose `service_id` matches that service are displayed; confirm factors for other services are hidden.\n- Switch between different services in the dropdown and verify the table updates accordingly without errors or stale rows.\n- If there are no factors for a chosen service, confirm an appropriate empty-state message is shown instead of a blank or broken table.\n\n3. Persistence and navigation tests\n- With a specific service selected in the dropdown, navigate to another Admin tab (e.g., Services or Add-ons) and then back to Pricing Factors.\n- Verify that the previously selected service filter is still active and the table is still filtered accordingly.\n- If URL-based persistence is used, refresh the page and confirm the same filter is reapplied from the URL or stored state.\n\n4. Regression and integration checks\n- Confirm that Task 3’s pricing calculations still produce correct numeric totals and that the currency change has not altered any underlying math (only formatting).\n- Create or edit quotes (including flows from Task 15 once available) and verify that edited quotes still display and export with correct `£` values.\n- Run existing automated tests (especially those around pricing and Admin Panel from Tasks 3, 9, 11, 12, 13, 14) and ensure they pass; update any assertions that checked for `$` to now expect `£`.",
        "status": "pending",
        "dependencies": [
          1,
          3,
          9,
          14
        ],
        "priority": "medium",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-12-10T05:44:01.454Z",
      "taskCount": 12,
      "completedCount": 12,
      "tags": [
        "master"
      ],
      "created": "2025-12-10T05:59:56.071Z",
      "description": "Tasks for master context",
      "updated": "2025-12-10T06:21:47.579Z"
    }
  }
}